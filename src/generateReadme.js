import fs from "fs";
import path from "path";
import chalk from "chalk";

const generateReadme = (metadata, includeBadges) => {
  if (!metadata) {
    console.log(chalk.red("Error: No project metadata found. README generation aborted."));
    return;
  }

  // Extract GitHub repo details for badges
  let repoBadgePath = "";
  if (metadata.repository && metadata.repository.includes("github.com")) {
    const repoParts = metadata.repository.split("github.com/")[1].split("/");
    const username = repoParts[0];
    const repoName = repoParts[1];

    repoBadgePath = `${username}/${repoName}`;
  }

  let readmeContent = `# ${metadata.name} ğŸš€  

> ${metadata.description}  

## ğŸ“Œ Table of Contents
- [ğŸ† Badges](#-badges)
- [ğŸ“– Overview](#-overview)
- [âš™ï¸ Installation](#-installation)
- [ğŸš€ Features](#-features)
- [ğŸ“‚ Project Structure](#-project-structure)
- [ğŸ’¡ Usage](#-usage)
- [ğŸ‘¥ Contributing](#-contributing)
- [ğŸ› ï¸ Tech Stack](#-tech-stack)
- [ğŸ“œ License](#-license)
- [ğŸ”® Future Improvements](#-future-improvements)
- [â“ FAQ](#-faq)

`;

  if (includeBadges) {
    readmeContent += `## ğŸ† Badges
![GitHub stars](https://img.shields.io/github/stars/${repoBadgePath}.svg)
![GitHub issues](https://img.shields.io/github/issues/${repoBadgePath}.svg)
![GitHub license](https://img.shields.io/github/license/${repoBadgePath}.svg)
![npm downloads](https://img.shields.io/npm/dt/${metadata.name}.svg)

`;
  }

  readmeContent += `## ğŸ“– Overview
${metadata.description}

This project is designed to **solve XYZ problem** using **XYZ technology**. It is lightweight, highly customizable, and easy to set up.

## âš™ï¸ Installation

\`\`\`sh
# Clone the repository
git clone ${metadata.repository || "<repository_url>"} my-project

# Navigate to the project directory
cd my-project

# Install dependencies
npm install

# Run the application
npm start
\`\`\`

> ğŸ“ **Note:** Make sure you have **Node.js v14+** installed before running this project.

---

## ğŸš€ Features
âœ… Feature 1 - Description  
âœ… Feature 2 - Description  
âœ… Feature 3 - Description  
âœ… Feature 4 - Description  

---

## ğŸ“‚ Project Structure

\`\`\`sh
my-project/
â”‚â”€â”€ src/               # Source code
â”‚   â”œâ”€â”€ components/    # UI Components
â”‚   â”œâ”€â”€ utils/         # Utility functions
â”‚   â”œâ”€â”€ api/           # API calls
â”‚â”€â”€ public/            # Static assets
â”‚â”€â”€ package.json       # Project metadata
â”‚â”€â”€ README.md          # Documentation
\`\`\`

> ğŸ’¡ **Tip:** This is a suggested structure. You can modify it based on your needs.

---

## ğŸ’¡ Usage

\`\`\`sh
# Run in development mode
npm run dev

# Build for production
npm run build

# Run tests
npm test
\`\`\`

> ğŸ› ï¸ **For CLI-based projects**, replace this with example command usages.

---

## ğŸ‘¥ Contributing

Contributions are always welcome! To contribute:
1. **Fork the repository**
2. **Create a new branch** for your feature:
   \`\`\`sh
   git checkout -b feature-name
   \`\`\`
3. **Make your changes & commit**:
   \`\`\`sh
   git commit -m "Add feature-name"
   \`\`\`
4. **Push to your fork & submit a PR**.

---

## ğŸ› ï¸ Tech Stack

ğŸ”¹ **Frontend:** React, Vue, or your choice  
ğŸ”¹ **Backend:** Node.js, Express  
ğŸ”¹ **Database:** MongoDB, PostgreSQL  
ğŸ”¹ **DevOps:** Docker, CI/CD  

---

## ğŸ“œ License
This project is licensed under the **${metadata.license}** License.

---

## ğŸ”® Future Improvements
- [ ] Feature 1  
- [ ] Feature 2  
- [ ] Improve performance  
- [ ] More integrations  

---

## â“ FAQ

**Q: How do I customize this project?**  
A: Edit \`config.js\` or modify \`package.json\` settings.

**Q: Can I use this in production?**  
A: Absolutely! Follow best practices and security guidelines.

---

> ğŸ“ **Notes:**  
> - This README file can be further **customized for different templates** like CLI tools, API projects, or open-source frameworks.  
> - The "TODO" section should be updated as features get implemented.  
> - Contributors should ensure **code consistency** with linting tools.

---

ğŸš€ **Generated by [AutoReadMe](https://github.com/CodeTirtho97/AutoREADME)**
`;

  const readmePath = path.resolve(process.cwd(), "README.md");
  
  fs.writeFileSync(readmePath, readmeContent, "utf-8");
  
  console.log(chalk.green(`âœ… README.md successfully created at ${readmePath}`));
};

export default generateReadme;
